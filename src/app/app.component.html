<mat-toolbar color="primary" id="header">
  <span>Slope Calculator</span>
  <!-- <span class="spacer"></span>
  <button mat-icon-button id="options-button" (click)="openSettingsDialog()">
    <mat-icon>settings</mat-icon>
  </button> -->
</mat-toolbar>

<div id="main">
  <mat-card class="card">
    <div id="instruction-container">
      <p id="instruction-text">Use inputs or sliders to adjust values in the table below:</p>
      <mat-slide-toggle id="y2-toggle" color="accent" [checked]="useY2"
                        (click)="toggleY2($event)">Use Y2</mat-slide-toggle>
    </div>

    <!-- TODO: Fix styling when screen is not wide enough -->
    <div id="inputs-container">
      <div id="y1-input">
        <div class="variable-container">
          <mat-form-field class="variable-form-field">
            <mat-label>Elevation (Y1)</mat-label>
            <input matInput class="variable-input" [disabled]="lockedVariable === 'y1'" required
                   [ngModel]="y1" (ngModelChange)="updateY1($event)" />
            <mat-icon matSuffix class="lock-icon" [ngClass]="{ locked: lockedVariable === 'y1' }" *ngIf="useY2"
                      (click)="lock('y1')">{{ lockedVariable === 'y1' ? 'lock' : 'lock_open' }}</mat-icon>
          </mat-form-field>
          <div class="slider-container">
            <mat-slider class="variable-slider" min="0" max="500" step="1">
              <input matSliderThumb [disabled]="lockedVariable === 'y1'"
                     [ngModel]="y1" (ngModelChange)="updateY1($event)">
            </mat-slider>
          </div>
        </div>
      </div>

      <div id="y2-input" *ngIf="useY2">
        <div class="variable-container">
          <mat-form-field class="variable-form-field">
            <mat-label>Elevation (Y2)</mat-label>
            <input matInput class="variable-input" [disabled]="lockedVariable === 'y2'" required
                   [ngModel]="y2" (ngModelChange)="updateY2($event)" />
            <mat-icon matSuffix class="lock-icon" [ngClass]="{ locked: lockedVariable === 'y2' }"
                      (click)="lock('y2')">{{ lockedVariable === 'y2' ? 'lock' : 'lock_open' }}</mat-icon>
          </mat-form-field>
          <div class="slider-container">
            <mat-slider class="variable-slider" min="0" max="500" step="1">
              <input matSliderThumb [disabled]="lockedVariable === 'y2'"
                     [ngModel]="y2" (ngModelChange)="updateY2($event)">
            </mat-slider>
          </div>
        </div>
      </div>

      <div id="x-input">
        <div class="variable-container">
          <mat-form-field class="variable-form-field">
            <mat-label>Length (X)</mat-label>
            <input matInput class="variable-input" [disabled]="lockedVariable === 'x'" required
                   [ngModel]="x" (ngModelChange)="updateX($event)" />
            <mat-icon matSuffix class="lock-icon" [ngClass]="{ locked: lockedVariable === 'x' }" *ngIf="useY2"
                      (click)="lock('x')">{{ lockedVariable === 'x' ? 'lock' : 'lock_open' }}</mat-icon>
          </mat-form-field>
          <div class="slider-container">
            <mat-slider class="variable-slider" min="0" max="500" step="1">
              <input matSliderThumb [disabled]="lockedVariable === 'x'"
                     [ngModel]="x" (ngModelChange)="updateX($event)">
            </mat-slider>
          </div>
        </div>
      </div>

      <div id="slope-input">
        <div class="variable-container">
          <div class="flex-container">
            <mat-form-field class="slope-form-field">
              <mat-label>Slope Min (%)</mat-label>
              <input matInput class="slope-input" required
                     [ngModel]="minSlope" (ngModelChange)="updateMinSlope($event)" />
            </mat-form-field>
            <mat-form-field class="slope-form-field">
              <mat-label>Slope Max (%)</mat-label>
              <input matInput class="slope-input" required
                     [ngModel]="maxSlope" (ngModelChange)="updateMaxSlope($event)" />
            </mat-form-field>
          </div>
          <div class="slider-container">
            <mat-slider class="variable-slider" [min]="defaultMinSlope" [max]="defaultMaxSlope" step="0.01">
              <input matSliderStartThumb [ngModel]="minSlope" (ngModelChange)="updateMinSlope($event)">
              <input matSliderEndThumb [ngModel]="maxSlope" (ngModelChange)="updateMaxSlope($event)">
            </mat-slider>
          </div>
        </div>
      </div>
    </div>

    <!-- TODO: Add sorting on table headers -->
    <div id="chart-container" *ngIf="chartRows.length > 0">
      <table mat-table id="chart-table" [dataSource]="chartRows">

        <ng-container matColumnDef="y1">
          <th mat-header-cell *matHeaderCellDef class="chart-cell"> Elevation (Y1) </th>
          <td mat-cell *matCellDef="let item" class="chart-cell"> {{ item.y1 | number:'1.0-2' }} </td>
        </ng-container>

        <ng-container matColumnDef="y2">
          <th mat-header-cell *matHeaderCellDef class="chart-cell"> Elevation (Y2) </th>
          <td mat-cell *matCellDef="let item" class="chart-cell"> {{ item.y2 | number:'1.0-2' }} </td>
        </ng-container>

        <ng-container matColumnDef="x">
          <th mat-header-cell *matHeaderCellDef class="chart-cell"> Length (X) </th>
          <td mat-cell *matCellDef="let item" class="chart-cell"> {{ item.x | number:'1.0-2' }} </td>
        </ng-container>

        <ng-container matColumnDef="slope">
          <th mat-header-cell *matHeaderCellDef class="chart-cell"> Slope (%) </th>
          <td mat-cell *matCellDef="let item" class="chart-cell"> {{ (item.slope * 100) | number:'1.0-2' }} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="chart-header-row"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="chart-row"></tr>
      </table>
    </div>
  </mat-card>
</div>

<footer>
  <div>&#169; {{ currentYear }}. All rights reserved.</div>
</footer>
